import type { NextPage } from "next";
import Head from "next/head";
import Image from "next/image";
import styles from "../styles/Home.module.css";
import React from "react";
import axios from "axios";
import { parse } from "node-html-parser";

const Home: NextPage = ({ now, bbcHead, cnnHead }: any) => {
  React.useEffect(() => {
    console.log(bbcHead);
  }, [bbcHead]);
  return (
    <div className={styles.container}>
      <Head>
        <title> {new Date(Date.now()).toLocaleString()}</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <p>deployed at : {new Date(now).toLocaleString()}</p>
      <h1 style={{ color: "#222", textAlign: "center", fontSize: 72 }}>
        {bbcHead.split(" ")[3]} : {cnnHead.split(" ")[3]}
      </h1>
    </div>
  );
};

export const getStaticProps = async () => {
  const { data: bbcHTML } = await axios.get(`https://www.bbc.com/news`);

  const bbcRoot = parse(bbcHTML);
  const bbcHead = bbcRoot.querySelector(".gs-c-promo-heading__title")?.text;

  const { data: cnnHTML } = await axios.get(`https://www.bbc.com/future`);
  const cnnRoot = parse(cnnHTML);
  const cnnHead =
    cnnRoot.querySelector(".article-hero__title-text")?.text ?? "null";

  return {
    props: {
      bbcHead,
      cnnHead,
      now: Date.now(),
    },
  };
};

export default Home;
